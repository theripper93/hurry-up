{"version":3,"file":"./index.js","mappings":"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","sources":["webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///./scripts/lib/socket.js","webpack:///./scripts/lib/utils.js","webpack:///./scripts/app/CombatTimer.js","webpack:///./scripts/lib/formBuilder.js","webpack:///./scripts/main.js","webpack:///./scripts/settings.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","import { MODULE_ID } from \"../main.js\";\r\n\r\n/**\r\n * Imports the Socket class from the specified module.\r\n * @module lib/socket\r\n */\r\n/* import { Socket } from \"./lib/socket.js\"; */\r\n\r\n/**\r\n * Registers a socket event with the specified name, callback function, and default options.\r\n * @param {string} eventName - The name of the event.\r\n * @param {function} callback - The function to call when the event is received.\r\n * @param {object} defaultOptions - The default options for the event.\r\n * @param {boolean} defaultOptions.response - If true, the event will wait for a response from other users.\r\n * @param {number} defaultOptions.timeout - The time in milliseconds to wait for a response.\r\n * @returns {void}\r\n * @example\r\n * Socket.register(\"rollSkill\", async ({ skill, actorId }) => {\r\n *    const actor = game.actors.get(actorId) ?? game.user.character;\r\n *    return await actor.rollSkill(skill);\r\n * }, { response: true, timeout: 30000 });\r\n */\r\n/* Socket.register(\"eventName\", ({ data }) => {}, defaultOptions); */\r\n\r\n/**\r\n * Calls a socket event with the specified data and options.\r\n * @param {object} data - The data to send to other users.\r\n * @param {object | string | array} options - The options for the event.\r\n * @param {string | array} options.users - The users to send the event to.\r\n * @param {boolean} options.response - If true, the event will wait for a response from other users.\r\n * @param {number} options.timeout - The time in milliseconds to wait for a response.\r\n * @returns {Promise} - The promise will resolve with the results from other users.\r\n * @example\r\n * const results = await Socket.rollSkill({ skill: \"acr\", actorId: \"f4y54ytw34s32\" }, \"others\");\r\n */\r\n/* const results = await Socket.eventName({ data }, options); */\r\n\r\n/**\r\n * Constants representing special user identifiers that can be used in place of a userId field.\r\n * These constants can be accessed using the `Socket.USERS` object. You can use their lower case string values as well.\r\n * @namespace\r\n * @property {string} GMS - All Game Masters (GMs).\r\n * @property {string} PLAYERS - All players.\r\n * @property {string} ALL - All users.\r\n * @property {string} OTHERS - All users except the current user.\r\n * @property {string} FIRSTGM - The first Game Master.\r\n * @property {string} SELF - The current user.\r\n */\r\n\r\nexport class Socket {\r\n    static __$callbacks = {};\r\n\r\n    static __$stores = {};\r\n\r\n    static __$promises = {};\r\n\r\n    static USERS = {\r\n        GMS: \"gms\",\r\n        PLAYERS: \"players\",\r\n        ALL: \"all\",\r\n        OTHERS: \"others\",\r\n        FIRSTGM: \"firstGM\",\r\n        SELF: \"self\",\r\n    };\r\n\r\n    static __$reserved = [\"__$eventName\", \"__$response\", \"__$onMessage\", \"__$parseUsers\", \"register\", \"USERS\"];\r\n\r\n    static async __$onMessage(data) {\r\n        const options = data.__$socketOptions;\r\n\r\n        if (options.__$storeName) {\r\n            if (options.__$request) {\r\n                const store = this.__$stores[options.__$storeName];\r\n                const _isLive = store._isLive;\r\n                if (!_isLive) return;\r\n                game.socket.emit(`module.${MODULE_ID}`, { __$socketOptions: { __$storeName: options.__$storeName, user: game.user.id }, data: store.getData() });\r\n            } else {\r\n                this.__$stores[options.__$storeName].synchronize(data.data, game.users.get(options.user));\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (options.__$eventName === \"__$response\") {\r\n            const key = options.__$responseKey;\r\n            if (this.__$promises[key]) {\r\n                this.__$promises[key].resolve({ user: game.users.get(options.__$userId), response: data.result });\r\n                delete this.__$promises[key];\r\n            }\r\n            return;\r\n        }\r\n        if (!options.users.includes(game.user.id)) return;\r\n        const callback = this.__$callbacks[options.__$eventName];\r\n        delete data.__$socketOptions;\r\n        const result = await callback(data);\r\n        if (options.response) {\r\n            const key = `${options.__$eventId}.${game.user.id}`;\r\n            const data = { __$socketOptions: { __$eventName: \"__$response\", __$responseKey: key, __$userId: game.user.id }, result };\r\n            this.__$socket.emit(`module.${MODULE_ID}`, data);\r\n        }\r\n    }\r\n\r\n    static __$parseUsers(options) {\r\n        if (Array.isArray(options?.users)) return options;\r\n        if (typeof options === \"string\") options = { users: options };\r\n        if (Array.isArray(options)) options = { users: options };\r\n        options.users = options.users || this.USERS.ALL;\r\n        const active = game.users.filter((u) => u.active);\r\n        const users = options.users;\r\n        if (users === this.USERS.ALL) {\r\n            options.users = active.map((u) => u.id);\r\n        } else if (users === this.USERS.GMS) {\r\n            options.users = active.filter((u) => u.isGM).map((u) => u.id);\r\n        } else if (users === this.USERS.PLAYERS) {\r\n            options.users = active.filter((u) => !u.isGM).map((u) => u.id);\r\n        } else if (users === this.USERS.OTHERS) {\r\n            options.users = active.filter((u) => u.id !== game.user.id).map((u) => u.id);\r\n        } else if (users === this.USERS.FIRSTGM) {\r\n            options.users = [game.users.activeGM.id];\r\n        } else if (users === this.USERS.SELF) {\r\n            options.users = [game.user.id];\r\n        }\r\n        return options;\r\n    }\r\n\r\n    static register(eventName, callback, defaultOptions = {}) {\r\n        if (!this.__$socket) {\r\n            this.__$socket = game.socket;\r\n            game.socket.on(`module.${MODULE_ID}`, this.__$onMessage.bind(this));\r\n        }\r\n\r\n        if (this.__$reserved.includes(eventName)) {\r\n            throw new Error(`Socket event name ${eventName} is reserved`);\r\n        }\r\n\r\n        this.__$callbacks[eventName] = callback;\r\n\r\n        const wrappedCallback = async (data = {}, options = {}) => {\r\n            options = { ...defaultOptions, ...options };    \r\n            options = this.__$parseUsers(options);\r\n            const eventId = foundry.utils.randomID();\r\n            options.__$eventId = eventId;\r\n            options.__$eventName = eventName;\r\n            const promises = [];\r\n            const local = options.users.includes(game.user.id);\r\n            options.users = options.users.filter((u) => u !== game.user.id);\r\n            if (options.response) {\r\n                for (const user of options.users) {\r\n                    promises.push(\r\n                        new Promise((resolve, reject) => {\r\n                            const key = `${eventId}.${user}`;\r\n                            this.__$promises[key] = { resolve, reject };\r\n                        }),\r\n                    );\r\n                }\r\n\r\n                setTimeout(() => {\r\n                    for (const user of options.users) {\r\n                        const key = `${eventId}.${user}`;\r\n                        if (this.__$promises[key]) {\r\n                            this.__$promises[key].reject({ user: game.users.get(user), response: \"timeout\" });\r\n                            delete this.__$promises[key];\r\n                        }\r\n                    }\r\n                }, options.timeout || 30000);\r\n            }\r\n\r\n            data.__$socketOptions = options;\r\n            this.__$socket.emit(`module.${MODULE_ID}`, data);\r\n\r\n            const results = [];\r\n\r\n            if (local) {\r\n                const localWrapper = async () => {\r\n                    return { user: game.user, response: await callback(data) };\r\n                };\r\n                promises.push(localWrapper());\r\n            }\r\n\r\n            const allPromises = await Promise.all(promises);\r\n            for (const promise of allPromises) {\r\n                results.push(promise);\r\n            }\r\n\r\n            return results;\r\n        };\r\n\r\n        this[eventName] = wrappedCallback.bind(this);\r\n    }\r\n\r\n    static registerStore(storeName, initialValue = {}, callback = null) {\r\n        if (this.__$reserved.includes(storeName)) {\r\n            throw new Error(`Store name ${storeName} is reserved`);\r\n        }\r\n\r\n        if (typeof initialValue !== \"object\") {\r\n            throw new Error(\"Initial value for store must be an object\");\r\n        }\r\n\r\n        this.__$stores[storeName] = new SynchronizedStore(storeName, initialValue, callback);\r\n\r\n        Object.defineProperty(this, storeName, {\r\n            get: () => {\r\n                return this.__$stores[storeName].getData();\r\n            },\r\n            set: (value) => {\r\n                this.__$stores[storeName].setData(value);\r\n            },\r\n        });\r\n\r\n        return this.__$stores[storeName];\r\n    }\r\n}\r\n\r\nclass SynchronizedStore {\r\n    constructor(storeName, initialValue, callback) {\r\n        this._storeName = storeName;\r\n\r\n        this._onChange = callback;\r\n\r\n        this._data = initialValue;\r\n\r\n        this._timestamp = Date.now();\r\n\r\n        this._isLive = false;\r\n\r\n        //request value from other users\r\n        game.socket.emit(`module.${MODULE_ID}`, { __$socketOptions: { __$storeName: this._storeName, __$request: true, user: game.user.id } });\r\n    }\r\n\r\n    synchronize(data) {\r\n        this._data = data;\r\n        this._timestamp = Date.now();\r\n        this._isLive = true;\r\n        this._onChange?.(this.data);\r\n    }\r\n\r\n    getData() {\r\n        return this._data;\r\n    }\r\n\r\n    setData(value) {\r\n        this.synchronize(value);\r\n        game.socket.emit(`module.${MODULE_ID}`, { __$socketOptions: { __$storeName: this._storeName, user: game.user.id }, data: value });\r\n    }\r\n}\r\n","import { MODULE_ID } from \"../main.js\";\n\nexport class HandlebarsApplication extends foundry.applications.api.HandlebarsApplicationMixin(\n    foundry.applications.api.ApplicationV2,\n) {\n    constructor(...args) {\n        super(...args);\n        this.constructor.registerPositionSetting();\n        this.savePosition = foundry.utils.debounce(\n            this.savePosition.bind(this),\n            100,\n        );\n    }\n\n    static registerPositionSetting() {\n        if (\n            this.POSITION_SETTING_REGISTERED ||\n            !this.DEFAULT_OPTIONS.window?.savePosition\n        )\n            return;\n        this.POSITION_SETTING_REGISTERED = true;\n        game.settings.register(MODULE_ID, this.APP_ID + \"-position\", {\n            scope: \"client\",\n            config: false,\n            type: Object,\n            default: {},\n        });\n    }\n\n    static resetSavedPosition() {\n        game.settings.set(MODULE_ID, this.APP_ID + \"-position\", {});\n    }\n\n    savePosition(position) {\n        const positionToSave = {\n            left: position.left,\n            top: position.top,\n            width: position.width,\n            height: position.height,\n        };\n        if (positionToSave.width === \"auto\") delete positionToSave.width;\n        if (positionToSave.height === \"auto\") delete positionToSave.height;\n        const currentSettings = game.settings.get(MODULE_ID, this.APP_ID + \"-position\");\n        game.settings.set(MODULE_ID, this.APP_ID + \"-position\", {\n            ...currentSettings,\n            [this.options.id]: positionToSave, \n        });\n    }\n\n    deletePosition() {\n        const currentSettings = game.settings.get(MODULE_ID, this.APP_ID + \"-position\");\n        delete currentSettings[this.options.id];\n        game.settings.set(MODULE_ID, this.APP_ID + \"-position\", currentSettings);\n    }\n\n    setPosition(...args) {\n        const r = super.setPosition(...args);\n        if (this.constructor.POSITION_SETTING_REGISTERED && this.options.window?.savePosition)\n            this.savePosition(this.position);\n        return r;\n    }\n\n    static get APP_ID() {\n        return this.name\n            .split(/(?=[A-Z])/)\n            .join(\"-\")\n            .toLowerCase();\n    }\n\n    get APP_ID() {\n        return this.constructor.APP_ID;\n    }\n\n    static get PARTS() {\n        return {\n            content: {\n                template: `modules/${MODULE_ID}/templates/${this.APP_ID}.hbs`,\n                classes: [],\n                scrollable: [],\n            },\n        };\n    }\n\n    static get DEFAULT_OPTIONS() {\n        return {\n            tag: \"div\",\n            // id: this.APP_ID,\n            window: {\n                title: `${MODULE_ID}.${this.APP_ID}.title`,\n                frame: true,\n                positioned: true,\n                icon: \"\",\n                controls: [],\n                minimizable: true,\n                resizable: false,\n                contentTag: \"section\",\n                contentClasses: [],\n                savePosition: false,\n                preventEscapeClose: false\n            },\n            actions: {},\n            form: {\n                handler: undefined,\n                submitOnChange: false,\n                closeOnSubmit: false,\n            },\n            position: {\n                width: 560,\n                height: \"auto\",\n            },\n        };\n    }\n\n    async _prepareContext(options) {\n        if (this.getData) return this.getData();\n        const data = {};\n        return { data };\n    }\n\n    activateListeners() {}\n\n    _onRender(context, options) {\n        super._onRender(context, options);\n        if (this.options.window.preventEscapeClose) {\n            foundry.applications.instances.delete(this.id, this);\n            this.window.close.style.display = \"none\"\n        }\n        const html = this.element;\n        if (this.activateListeners) this.activateListeners(html);\n    }\n\n    async render(options1 = {}, options2 = {}) {\n        const activeOptions =\n            typeof options1 === \"boolean\" ? options2 : options1;\n        if (\n            !activeOptions.position &&\n            this.constructor.POSITION_SETTING_REGISTERED\n        ) {\n            const savedPosition = game.settings.get(\n                MODULE_ID,\n                this.APP_ID + \"-position\",\n            );\n            activeOptions.position = savedPosition?.[this.options.id];\n        }\n        return super.render(options1, options2);\n    }\n}\n\nexport function dynamicImport(url) {\n    const dynamicImport = new Function(\"url\", \"return import(url)\");\n    return dynamicImport(url);\n}\n\nexport function confirm(title, content, options = {}) {\n    title = l(title);\n    content = l(content);\n    return foundry.applications.api.DialogV2.confirm({\n        window: { title },\n        content,\n    });\n}\n\nexport function prompt(title, content, options = {}) {\n    title = l(title);\n    content = l(content);\n    return foundry.applications.api.DialogV2.prompt({\n        window: { title },\n        content,\n        ...options,\n    });\n}\n\nexport function deepClone(obj) {\n    return foundry.utils.deepClone(obj);\n}\n\nexport function expandObject(obj) {\n    return foundry.utils.expandObject(obj);\n}\n\nexport function flattenObject(obj) {\n    return foundry.utils.flattenObject(obj);\n}\n\nexport function mergeObject(obj, other) {\n    return foundry.utils.mergeObject(obj, other);\n}\n\nexport function mergeClone(obj, other) {\n    obj = foundry.utils.deepClone(obj);\n    other = foundry.utils.deepClone(other);\n    return foundry.utils.mergeObject(obj, other);\n}\n\nexport function randomID(length = 20) {\n    return foundry.utils.randomID(length);\n}\n\nexport function setProperty(obj, key, value) {\n    return foundry.utils.setProperty(obj, key, value);\n}\n\nexport function getProperty(obj, key) {\n    return foundry.utils.getProperty(obj, key);\n}\n\nexport function l(x) {\n    return game.i18n.localize(x);\n}\n\nexport function easeInSine(x) {\n    return 1 - Math.cos((x * Math.PI) / 2);\n}\n\nexport function easeOutSine(x) {\n    return Math.sin((x * Math.PI) / 2);\n}\n\nexport function easeInOutSine(x) {\n    return -(Math.cos(Math.PI * x) - 1) / 2;\n}\n\nexport function easeInQuad(x) {\n    return x * x;\n}\n\nexport function easeOutQuad(x) {\n    return 1 - (1 - x) * (1 - x);\n}\n\nexport function easeInOutQuad(x) {\n    return x < 0.5 ? 2 * x * x : 1 - Math.pow(-2 * x + 2, 2) / 2;\n}\n\nexport function easeInCubic(x) {\n    return x * x * x;\n}\n\nexport function easeOutCubic(x) {\n    return 1 - Math.pow(1 - x, 3);\n}\n\nexport function easeInOutCubic(x) {\n    return x < 0.5 ? 4 * x * x * x : 1 - Math.pow(-2 * x + 2, 3) / 2;\n}\n\nexport function easeInQuart(x) {\n    return x * x * x * x;\n}\n\nexport function easeOutQuart(x) {\n    return 1 - Math.pow(1 - x, 4);\n}\n\nexport function easeInOutQuart(x) {\n    return x < 0.5 ? 8 * x * x * x * x : 1 - Math.pow(-2 * x + 2, 4) / 2;\n}\n\nexport function easeInQuint(x) {\n    return x * x * x * x * x;\n}\n\nexport function easeOutQuint(x) {\n    return 1 - Math.pow(1 - x, 5);\n}\n\nexport function easeInOutQuint(x) {\n    return x < 0.5 ? 16 * x * x * x * x * x : 1 - Math.pow(-2 * x + 2, 5) / 2;\n}\n\nexport function easeInExpo(x) {\n    return x == 0 ? x : Math.pow(2, 10 * (x - 1));\n}\n\nexport function easeOutExpo(x) {\n    return x == 1 ? x : 1 - Math.pow(2, -10 * x);\n}\n\nexport function easeInOutExpo(x) {\n    return x == 0\n        ? 0\n        : x == 1\n          ? 1\n          : x < 0.5\n            ? Math.pow(2, 20 * x - 10) / 2\n            : (2 - Math.pow(2, -20 * x + 10)) / 2;\n}\n\nexport function easeInCirc(x) {\n    return 1 - Math.sqrt(1 - Math.pow(x, 2));\n}\n\nexport function easeOutCirc(x) {\n    return Math.sqrt(1 - Math.pow(x - 1, 2));\n}\n\nexport function easeInOutCirc(x) {\n    return x < 0.5\n        ? 1 - Math.sqrt(1 - Math.pow(2 * x, 2)) / 2\n        : (Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2;\n}\n\nexport function easeInElastic(x) {\n    let s = 1.70158;\n    let p = 0;\n    let a = 1;\n    if (x == 0) return 0;\n    if ((x /= 1) == 1) return 1;\n    if (!p) p = 0.3;\n    if (a < 1) {\n        a = 1;\n        s = p / 4;\n    } else {\n        s = (p / (2 * Math.PI)) * Math.asin(1 / a);\n    }\n    return -(\n        a *\n        Math.pow(2, 10 * (x -= 1)) *\n        Math.sin(((x * 1 - s) * (2 * Math.PI)) / p)\n    );\n}\n\nexport function easeOutElastic(x) {\n    let s = 1.70158;\n    let p = 0;\n    let a = 1;\n    if (x == 0) return 0;\n    if ((x /= 1) == 1) return 1;\n    if (!p) p = 0.3;\n    if (a < 1) {\n        a = 1;\n        s = p / 4;\n    } else {\n        s = (p / (2 * Math.PI)) * Math.asin(1 / a);\n    }\n    return (\n        a * Math.pow(2, -10 * x) * Math.sin(((x * 1 - s) * (2 * Math.PI)) / p) +\n        1\n    );\n}\n\nexport function easeInOutElastic(x) {\n    let s = 1.70158;\n    let p = 0;\n    let a = 1;\n    if (x == 0) return 0;\n    if ((x /= 1 / 2) == 2) return 1;\n    if (!p) p = 0.3 * (0.3 + 1);\n    if (a < 1) {\n        a = 1;\n        s = p / 4;\n    } else {\n        s = (p / (2 * Math.PI)) * Math.asin(1 / a);\n    }\n    if (x < 1)\n        return (\n            -0.5 *\n            (a *\n                Math.pow(2, 10 * (x -= 1)) *\n                Math.sin(((x * 1 - s) * (2 * Math.PI)) / p))\n        );\n    return (\n        a *\n            Math.pow(2, -10 * (x -= 1)) *\n            Math.sin(((x * 1 - s) * (2 * Math.PI)) / p) *\n            0.5 +\n        1\n    );\n}\n\nexport function easeInBack(x) {\n    let s = 1.70158;\n    return x * x * ((s + 1) * x - s);\n}\n\nexport function easeOutBack(x) {\n    let s = 1.70158;\n    return 1 - (1 - x) * (1 - x) * ((s + 1) * x - s);\n}\n\nexport function easeInOutBack(x) {\n    let s = 1.70158;\n    if ((x /= 1 / 2) < 1)\n        return (1 / 2) * (x * x * (((s *= 1.525) + 1) * x - s));\n    return (1 / 2) * ((x -= 2) * x * (((s *= 1.525) + 1) * x + s) + 2);\n}\n\nexport function addColorPicker(input, { value, opacity = false } = {}) {\n    const hexToComponents = (hex) => {\n        const hexColor =\n            hex.length < 9 ? hex + \"f\".repeat(9 - hex.length) : hex;\n\n        const colorValue = hexColor.slice(0, 7);\n        const alphaValue = parseInt(hexColor.slice(7, 9), 16) / 255;\n        return { color: colorValue, alpha: alphaValue };\n    };\n\n    const componentsToHex = (color, alpha) => {\n        const colorValue = color.replace(\"#\", \"\");\n        const alphaValue = Math.round(alpha * 255)\n            .toString(16)\n            .padStart(2, \"0\");\n        return `#${colorValue}${alphaValue}`;\n    };\n\n    const textInput =\n        input.type === \"text\"\n            ? input\n            : input.querySelector(\"input[type='text']\");\n    if (textInput.classList.contains(\"color-picker-added\")) return;\n\n    textInput.classList.add(\"color-picker-added\");\n    textInput.classList.add(\"color\");\n    const parent = textInput.parentElement;\n\n    value ??= textInput.value || \"#000000ff\";\n\n    const { color, alpha } = hexToComponents(value);\n\n    const colorPickerElement = document.createElement(\"input\");\n    colorPickerElement.setAttribute(\"type\", \"color\");\n    if (opacity) colorPickerElement.style.maxWidth = \"2rem\";\n\n    const alphaPickerHtml = `<range-picker min=\"0\" max=\"1\" step=\"0.01\" value=\"${alpha}\" data-tooltip=\"Alpha\" style=\"min-width: 6rem;\"></range-picker>`;\n    const alphaPickerElement = new DOMParser()\n        .parseFromString(alphaPickerHtml, \"text/html\")\n        .querySelector(\"range-picker\");\n\n    const updateTextInput = (color, alpha) => {\n        const hex = componentsToHex(color, alpha);\n        if (!opacity) textInput.value = hex.slice(0, 7);\n        else textInput.value = hex;\n        textInput.dispatchEvent(new Event(\"change\"));\n    };\n\n    colorPickerElement.value = color;\n    alphaPickerElement.value = alpha;\n\n    colorPickerElement.addEventListener(\"input\", (event) => {\n        const color = event.target.value;\n        const alpha = alphaPickerElement.value;\n        updateTextInput(color, alpha);\n    });\n\n    alphaPickerElement.addEventListener(\"input\", (event) => {\n        const alpha = event.target.value;\n        const color = colorPickerElement.value;\n        updateTextInput(color, alpha);\n    });\n\n    textInput.after(colorPickerElement);\n    opacity && colorPickerElement.after(alphaPickerElement);\n}\n","import {Socket} from \"../lib/socket.js\";\nimport { HandlebarsApplication, mergeClone, randomID, l } from \"../lib/utils.js\";\n\nexport class CombatTimer extends HandlebarsApplication {\n\n    static timerInstances = {};\n    constructor(id) {\n        const options = game.settings.get(\"hurry-up\", \"timersData\")[id];\n        const overrideOptions = {};\n        if (options.isSecondary) {\n            overrideOptions.position = {\n                top: window.innerHeight / 2,\n                left: window.innerWidth / 2,\n            };\n            overrideOptions.id = id;\n            if (options.name) {\n                overrideOptions.classes = [\"named\"];\n                overrideOptions.window = { title: options.name };\n            }\n        }\n        super(overrideOptions);\n        this.mainName = l(\"COMBAT.Turn\");\n        this.started = false;\n        this.sleepTimer = undefined;\n        this.setupTimer(false);\n        this.sandFrame = 0;\n        CombatTimer.timerInstances[this.options.id] = this;\n        this.startTimer();\n    }\n\n    setupColors() {\n        this.color ||= getComputedStyle(this.element).color;\n        this.glassColor = getComputedStyle(this.element).color;\n        this.criticalColor = \"rgba(255, 0, 0, 0.75)\";\n        this.barCriticalColor = \"rgb(255, 0, 0)\";\n    }\n\n    setupTimer(render = false) {\n        const currentTimersData = game.settings.get(\"hurry-up\", \"timersData\") ?? {};\n        const timerData = currentTimersData[this.options.id];\n        this.timeNow = game.time.serverTime;\n        this.name = timerData.name;\n        this.isSecondary = timerData.isSecondary;\n        this.time = timerData.time ?? game.settings.get(\"hurry-up\", \"timerDuration\");\n        this.color = timerData.color;\n        this.style = timerData.style ?? game.settings.get(\"hurry-up\", \"style\") ?? \"digits\";\n        this.countup = game.settings.get(\"hurry-up\", \"countup\");\n        if (timerData.startedAt) {\n            this.startedAt = timerData.startedAt;\n            this.manuallyPaused = timerData.manuallyPaused ?? false;\n            this.pausedAt = timerData.pausedAt ?? this.timeNow;\n            this.pausedFor = timerData.pausedFor ?? 0;\n\n            const isCurrentlyPaused = game?.paused || this.manuallyPaused;\n            if (isCurrentlyPaused) {\n                this.pausedFor = this.pausedFor + game.time.serverTime - this.pausedAt;\n                this.pausedAt = this.timeNow;\n                this.timeElapsed = this.pausedAt - this.startedAt - this.pausedFor;\n            } else {\n                this.timeElapsed = this.timeNow - this.startedAt - this.pausedFor;\n            }\n            this.timeRemaining = this.time - Math.floor(this.timeElapsed / 1000);\n            this.timeRemaining = Math.max(this.timeRemaining, 0);\n        } else {\n            this.startedAt = this.timeNow;\n            this.manuallyPaused = false;\n            this.pausedAt = this.isPaused() ? this.timeNow : undefined;\n            this.pausedFor = 0;\n            this.timeElapsed = 0;\n            this.timeRemaining = this.time;\n        }\n        this.hasEnded = this.timeRemaining <= 0;\n        if(render) this.render();\n    }\n\n    static reset(id) {\n        const currentTimersData = game.settings.get(\"hurry-up\", \"timersData\") ?? {};\n        const timerData = currentTimersData[id];\n\n        timerData.startedAt = game.time.serverTime;\n        timerData.pausedAt = undefined;\n        const isCurrentlyPaused = game?.paused || timerData.manuallyPaused;\n        if (isCurrentlyPaused) {\n            timerData.pausedAt = game.time.serverTime;\n        }\n        timerData.pausedFor = 0;\n\n        game.settings.set(\"hurry-up\", \"timersData\", currentTimersData);\n    }\n\n    static async setPause(id, paused, manual) {\n        const currentTimersData = game.settings.get(\"hurry-up\", \"timersData\") ?? {};\n        const timerData = currentTimersData[id];\n        \n        if (manual) {\n            timerData.manuallyPaused = paused;\n        }\n        const isCurrentlyPaused = game?.paused || timerData.manuallyPaused;\n        const isEnteringPause = isCurrentlyPaused && !timerData.pausedAt;\n        const isExitingPause = !isCurrentlyPaused && !!timerData.pausedAt;\n        if (isEnteringPause) {\n            timerData.pausedAt = game.time.serverTime;\n        }\n        if (isExitingPause) {\n            timerData.pausedFor = timerData.pausedFor + game.time.serverTime - timerData.pausedAt;\n            timerData.pausedAt = undefined;\n        }\n        await game.settings.set(\"hurry-up\", \"timersData\", currentTimersData);\n    }\n\n    isPaused() {\n        return game?.paused || this.manuallyPaused;\n    }\n\n    isManuallyPaused() {\n        return this.manuallyPaused;\n    }\n\n    isSecondaryTimer() {\n        return this.isSecondary;\n    }\n\n    _configureRenderParts(...args) {\n        const parts = super._configureRenderParts(...args);\n        let template;\n        switch (this.style) {\n            case \"digits\":\n                template = `modules/hurry-up/templates/hurry-up-digits.hbs`;\n                break;\n            case \"circle\":\n            case \"sand\":\n                template = `modules/hurry-up/templates/hurry-up-canvas.hbs`;\n                break;\n        }\n        parts.content.template = template;\n        return parts;\n    }\n\n    static get DEFAULT_OPTIONS() {\n        return mergeClone(super.DEFAULT_OPTIONS, {\n            tag: \"div\",\n            id: \"hurry-up\",\n            classes: [\"hurry-up\"],\n            window: {\n                title: \"\",\n                minimizable: true,\n                resizable: false,\n                preventEscapeClose: true,\n                savePosition: true,\n            },\n            position: {\n                width: \"auto\",\n                height: \"auto\",\n            }\n        });\n    }\n\n    static get PARTS() {\n        return {\n            content: {\n                template: \"\",\n            },\n        };\n    }\n\n    startTimer(reset = false) {\n        if(reset) CombatTimer.reset(this.options.id);\n        this.started = true;\n        this.sleepTimer = setInterval(this.updateTime.bind(this), 100);\n    }\n\n    async onEnd() {\n        this.endSound();\n        if (game.settings.get(\"hurry-up\", \"goNext\") && game.user.isGM && !this.isSecondary) {\n            game.combat?.nextTurn();\n        }\n    }\n\n    async sleep(ms) {\n        return new Promise((resolve) => (this.sleepTimer = setTimeout(resolve, ms)));\n    }\n\n    async endSound() {\n        this.critSound?.stop();\n        const soundP = game.settings.get(\"hurry-up\", \"endSoundPath\");\n        if (soundP) foundry.audio.AudioHelper.play({ src: soundP, autoplay: true, volume: game.settings.get(\"hurry-up\", \"soundVol\"), loop: false }, false);\n    }\n\n    updateVisuals() {\n        switch (this.style) {\n            case \"digits\":\n                this.updateDigits();\n                break;\n            case \"circle\":\n                this.updateCircle();\n                break;\n            case \"sand\":\n                this.updateSand();\n        }\n    }\n\n    updateTime(forceRender = false) {\n        if (!this.element) return;\n        if (!this.isPaused()) {\n            this.timeNow = game.time.serverTime;\n            this.timeElapsed = this.timeNow - this.startedAt - this.pausedFor;\n            this.timeRemaining = this.time - Math.floor(this.timeElapsed / 1000);\n            this.timeRemaining = Math.max(this.timeRemaining, 0);\n        } else {\n            if (this.critSound?.playing) this.critSound?.pause();\n        }\n\n        if (!this.isPaused() || forceRender) {\n            this.updateVisuals();\n            this.checkCritical();\n            if (this.timeRemaining <= 0 && !this.hasEnded) {\n                this.onEnd();\n                this.hasEnded = true;\n            }\n            const name = this.isSecondary ? this.name : this.mainName;\n            if (this.minimized || this.style !== \"digits\") {\n                this._updateFrame({window: {title: `${name ? name + \" - \" : \"\"}${this.getFormattedTime()}`}});\n            } else {\n                this._updateFrame({window: {title: name}});\n            }\n        }\n    }\n\n    getFormattedTime() {\n        const time = (this.countup ? this.timeElapsed / 1000 : this.timeRemaining);\n        const hours = Math.floor(time / 3600);\n        const minutes = Math.floor((time % 3600) / 60);\n        const seconds = Math.floor(time % 60);\n        return `${hours > 0 ? `${hours}`.padStart(2, \"0\") + \":\" : \"\"}${`${minutes}`.padStart(2, \"0\")}:${`${seconds}`.padStart(2, \"0\")}`;\n    }\n\n    updateDigits() {\n        if (!this.element) return;\n\n        this.element\n            .querySelector(\".hurry-up-timer-text\")\n            .textContent = this.getFormattedTime();\n        let percent = Math.min(Math.max((this.timeRemaining / this.time) * 100, 0), 100);\n        if (this.countup) percent = 100 - percent;\n        this.element.querySelector(\".hurry-up-bar\").style.width = `${percent}%`;\n\n\n        // TODO: Fix initial state on countup to not have reset animation on first tick\n    }\n\n    updateCircle() {\n        if (!this.element) return;\n        const timePercentage = Math.min(Math.max(this.timeElapsed / (this.time * 1000), 0), 1);\n        const circleAngle = timePercentage * 360;\n        const canvasSize = game.settings.get(\"hurry-up\", \"size\") * 20;\n        const halfCanvasSize = canvasSize / 2;\n        const radius = halfCanvasSize - 5;\n        const canvas = this.element.querySelector(\".hurry-up-canvas\");\n        canvas.setAttribute(\"height\", canvasSize);\n        canvas.setAttribute(\"width\", canvasSize);\n        // canvas.style.width = \"inherit\";\n        // this.element.querySelector(\".window-header\").style.width = \"inherit\";\n        const context = canvas.getContext(\"2d\");\n        const sAngle = ((circleAngle / 360) * 2 - 0.5) * Math.PI;\n        const eAngle = 1.5 * Math.PI;\n        context.clearRect(0, 0, canvasSize, canvasSize);\n\n        context.fillStyle = this.glassColor;\n        context.moveTo(halfCanvasSize, halfCanvasSize);\n        context.beginPath();\n        context.arc(halfCanvasSize, halfCanvasSize, radius, 0, 2 * Math.PI);\n        context.globalAlpha = 0.2;\n        context.lineWidth = 1;\n        context.strokeStyle = this.glassColor;\n        context.stroke();\n        context.globalAlpha = 0.1;\n        context.fill();\n        context.globalAlpha = 1;\n        context.closePath();\n\n        context.beginPath();\n        context.fillStyle = this.isCritical || this.timeRemaining <= 0 ? this.criticalColor : this.color;\n        context.moveTo(halfCanvasSize, halfCanvasSize);\n        if (this.timeRemaining > 0) {\n            if (game.settings.get(\"hurry-up\", \"countup\")) {\n                context.arc(halfCanvasSize, halfCanvasSize, radius, eAngle, sAngle);\n            } else {\n                context.arc(halfCanvasSize, halfCanvasSize, radius, sAngle, eAngle);\n            }\n        } else {\n            if (game.settings.get(\"hurry-up\", \"countup\")) context.arc(halfCanvasSize, halfCanvasSize, radius, 0, 2 * Math.PI);\n        }\n        context.shadowOffsetX = 2;\n        context.shadowOffsetY = 2;\n        context.shadowColor = \"rgba(0, 0, 0, 0.75)\";\n        context.shadowBlur = 2;\n        context.fill();\n        context.closePath();\n    }\n\n    updateSand() {\n        if (!this.element) return;\n        // const canvasHeight = game.settings.get(\"hurry-up\", \"size\") * 20;\n        const canvasWidth = game.settings.get(\"hurry-up\", \"size\") * 20;\n        const canvasHeight = canvasWidth * 2;\n        const canvasHalfHeight = canvasHeight / 2;\n        const canvasHalfWidth = canvasWidth / 2;\n        const canvasMargin = canvasHeight * 0.025 > 5 ? 5 : Math.round(canvasHeight * 0.025);\n        const glassMargin = canvasMargin * 2;\n        const timePercentage = Math.min(Math.max(this.timeElapsed / (this.time * 1000), 0), 1);\n        const maxIncrement = (canvasHeight / 10) * 3;\n        const increment = maxIncrement * timePercentage;\n        const canvas = this.element.querySelector(\".hurry-up-canvas\");\n        const context = canvas.getContext(\"2d\");\n        canvas.setAttribute(\"height\", canvasHeight);\n        canvas.setAttribute(\"width\", canvasWidth);\n        //Fix for Google Chrome\n        canvas.style.width = canvasWidth + \"px\";\n        this.element.querySelector(\".window-header\").style.width = canvasWidth;\n        // this.element.querySelector(\".window-content\").style.alignItems = \"center\";\n        //\n        context.restore();\n        context.clearRect(0, 0, canvasWidth, canvasHeight);\n        //Glass\n        context.shadowOffsetX = 2;\n        context.shadowOffsetY = 2;\n        context.shadowColor = \"rgba(0, 0, 0, 1)\";\n        context.shadowBlur = 2;\n        context.beginPath();\n        context.moveTo(canvasHalfWidth, canvasMargin);\n        context.bezierCurveTo((canvasWidth / 10) * 9 - canvasMargin, canvasMargin, canvasWidth - canvasMargin, canvasHeight / 10, canvasWidth - canvasMargin, (canvasHeight / 10) * 2);\n        context.quadraticCurveTo(canvasWidth - canvasMargin, (canvasHeight / 10) * 3, (canvasWidth / 20) * 11, canvasHalfHeight);\n        context.quadraticCurveTo(canvasWidth - canvasMargin, (canvasHeight / 10) * 7, canvasWidth - canvasMargin, (canvasHeight / 10) * 8);\n        context.bezierCurveTo(canvasWidth - canvasMargin, (canvasHeight / 10) * 9, (canvasWidth / 10) * 9 - canvasMargin, canvasHeight - canvasMargin, canvasHalfWidth, canvasHeight - canvasMargin);\n        context.bezierCurveTo(canvasWidth / 10 + canvasMargin, canvasHeight - canvasMargin, canvasMargin, (canvasHeight / 10) * 9, canvasMargin, (canvasHeight / 10) * 8);\n        context.quadraticCurveTo(canvasMargin, (canvasHeight / 10) * 7, (canvasWidth / 20) * 9, canvasHalfHeight);\n        context.quadraticCurveTo(canvasMargin, (canvasHeight / 10) * 3, canvasMargin, (canvasHeight / 10) * 2);\n        context.bezierCurveTo(canvasMargin, canvasHeight / 10, canvasWidth / 10 + canvasMargin, canvasMargin, canvasHalfWidth, canvasMargin);\n        context.globalAlpha = 0.2;\n        context.lineWidth = 1;\n        context.strokeStyle = this.glassColor;\n        context.stroke();\n        context.fillStyle = this.glassColor;\n        context.globalAlpha = 0.1;\n        context.fill();\n        context.globalAlpha = 1;\n        context.closePath();\n        context.save();\n        // Clip\n        context.beginPath();\n        context.shadowColor = \"rgba(0, 0, 0, 0)\";\n        context.moveTo(canvasHalfWidth, glassMargin);\n        context.bezierCurveTo((canvasWidth / 4) * 3 - glassMargin, glassMargin, canvasWidth - glassMargin, canvasHeight / 10, canvasWidth - glassMargin, (canvasHeight / 10) * 2);\n        context.quadraticCurveTo(canvasWidth - glassMargin, (canvasHeight / 10) * 3, canvasHalfWidth, canvasHalfHeight);\n        context.quadraticCurveTo(canvasWidth - glassMargin, (canvasHeight / 10) * 7, canvasWidth - glassMargin, (canvasHeight / 10) * 8);\n        context.bezierCurveTo(canvasWidth - glassMargin, (canvasHeight / 10) * 9, (canvasWidth / 10) * 9 - glassMargin, canvasHeight - glassMargin, canvasHalfWidth, canvasHeight - glassMargin);\n        context.bezierCurveTo(canvasWidth / 10 + glassMargin, canvasHeight - glassMargin, glassMargin, (canvasHeight / 10) * 9, glassMargin, (canvasHeight / 10) * 8);\n        context.quadraticCurveTo(glassMargin, (canvasHeight / 10) * 7, canvasHalfWidth, canvasHalfHeight);\n        context.quadraticCurveTo(glassMargin, (canvasHeight / 10) * 3, glassMargin, (canvasHeight / 10) * 2);\n        context.bezierCurveTo(glassMargin, canvasHeight / 10, canvasWidth / 4 + glassMargin, glassMargin, canvasWidth / 2, glassMargin);\n        context.clip();\n        //Sand top\n        context.beginPath();\n        context.shadowColor = \"rgba(0, 0, 0, 0)\";\n        context.moveTo(0, (canvasHeight / 10) * 2 + increment);\n        context.lineTo(canvasWidth, (canvasHeight / 10) * 2 + increment);\n        context.lineTo(canvasWidth, canvasHalfHeight);\n        context.lineTo(0, canvasHalfHeight);\n        context.lineTo(0, 0);\n        context.fillStyle = this.isCritical ? this.criticalColor : this.color;\n        context.fill();\n        context.closePath();\n        //Sand bottom\n        context.beginPath();\n        context.moveTo(0, canvasHeight - glassMargin - increment);\n        context.lineTo(canvasWidth, canvasHeight - glassMargin - increment);\n        context.lineTo(canvasWidth, canvasHeight);\n        context.lineTo(0, canvasHeight);\n        context.lineTo(0, canvasHeight - glassMargin - increment);\n        context.fillStyle = this.isCritical || this.timeRemaining < 0 ? this.criticalColor : this.color;\n        context.fill();\n        context.closePath();\n        //Line\n        if (increment < maxIncrement) {\n            context.beginPath();\n            if (this.sandFrame % 2 == 0) {\n                context.lineDashOffset = 0;\n            } else {\n                context.lineDashOffset = 2;\n            }\n            context.setLineDash([2, 2]);\n            context.lineWidth = 1;\n            context.lineCap = \"round\";\n            context.moveTo(canvasHalfWidth, canvasHalfHeight);\n            context.lineTo(canvasHalfWidth, canvasHeight - glassMargin - increment);\n            context.strokeStyle = this.isCritical ? this.criticalColor : this.color;\n            context.stroke();\n            context.closePath();\n            this.sandFrame++;\n        }\n    }\n\n    updateWindowless() {\n        // const windowAppElement = document.querySelector(\".hurry-up\");\n        const windowHeaderElement = this.element.getElementsByClassName(\"window-header\");\n        if (!windowHeaderElement.length) return;\n        if (game.settings.get(\"hurry-up\", \"windowless\")) {\n            this.element.classList.add(\"windowless\");\n            windowHeaderElement[0].classList.add(\"windowless\");\n        } else {\n            this.element.classList.remove(\"windowless\");\n            windowHeaderElement[0].classList.remove(\"windowless\");\n        }\n    }\n\n    checkCritical() {\n        if (this.timeRemaining <= 0) {\n            this.onCriticalEnd();\n            this.setCriticalStyle();\n            return;\n        }\n\n        if (!this.isCritical) {\n            if(this.hasEnded) return;\n            if (game.settings.get(\"hurry-up\", \"secondsInsteadOfPercentage\")) {\n                if (this.timeRemaining <= game.settings.get(\"hurry-up\", \"critical\")) {\n                    this.isCritical = true;\n                }\n            } else {\n                const percent = (this.timeRemaining / this.time) * 100;\n                if (percent <= game.settings.get(\"hurry-up\", \"critical\")) {\n                    this.isCritical = true;\n                }\n            }\n            if (this.timeRemaining <= 2) this.isCritical = true;\n\n            if (this.isCritical) {\n                this.onCritical();\n                this.setCriticalStyle();\n            }\n        }\n    }\n\n    setCriticalStyle() {\n        if(this.isCritical) {\n            switch (this.style) {\n                case \"digits\":\n                    this.element.querySelector(\".hurry-up-bar\").style.backgroundColor = this.barCriticalColor;\n                    this.element.querySelector(\".hurry-up-timer-text\").classList.add(\"blinking\");\n                    break;\n                case \"circle\":\n                    this.element.querySelector(\".hurry-up-canvas\").classList.add(\"blinking\");\n            }\n        } else {\n            switch (this.style) {\n                case \"digits\":\n                    this.element.querySelector(\".hurry-up-bar\").style.backgroundColor = this.color;\n                    this.element.querySelector(\".hurry-up-timer-text\").classList.remove(\"blinking\");\n                    break;\n                case \"circle\":\n                    this.element.querySelector(\".hurry-up-canvas\").classList.remove(\"blinking\");\n            }\n        }\n    }\n\n    async onCritical() {\n        this.critSound?.stop();\n        const soundP = game.settings.get(\"hurry-up\", \"critSoundPath\");\n        if (soundP) this.critSound = await foundry.audio.AudioHelper.play({ src: soundP, autoplay: true, volume: game.settings.get(\"hurry-up\", \"soundVol\"), loop: true }, false);\n    }\n\n    async onCriticalEnd() {\n        this.isCritical = false;\n        this.critSound?.stop();\n    }\n\n    async minimize() {\n        super.minimize();\n        this.updateTime(true);\n    }\n\n    async maximize() {\n        super.maximize();\n        this.updateTime(true);\n    }\n\n    _onRender(context, options) {\n        super._onRender(context, options);\n        this.isCritical = false;\n        this.updateTime(true);\n        this.checkCritical();\n        const countup = game.settings.get(\"hurry-up\", \"countup\");\n        this.setupColors();\n        switch (this.style) {\n            case \"digits\":\n                this.element.querySelector(\".hurry-up-bar\").style.backgroundColor = this.color;\n                this.element.querySelector(\".hurry-up-bar\").style.width = \"0%\" ? countup : \"100%\";\n                this.element.querySelector(\".hurry-up-timer-text\").classList.remove(\"blinking\");\n                break;\n            case \"circle\":\n            case \"sand\":\n                this.element.querySelector(\".hurry-up-canvas\").classList.remove(\"blinking\");\n                break;\n        }\n        document.documentElement.style.setProperty(\"--hurry-up-font-size\", game.settings.get(\"hurry-up\", \"size\") + \"em\");\n        this.updateWindowless();\n        this.setCriticalStyle();\n        if (this.manuallyPaused) this.element.classList.add(\"paused\");\n        else this.element.classList.remove(\"paused\");\n    }\n\n    _onFirstRender(...args) {\n        super._onFirstRender(...args);\n        if (!game.user.isGM) return;\n        new foundry.applications.ux.ContextMenu(\n            this.element,\n            \".window-content, .window-header\",\n            [\n                {\n                    condition: () => this.isManuallyPaused(),\n                    name: `hp.contextMenu.unpause`,\n                    icon: `<i class=\"fas fa-play\"></i>`,\n                    callback: () => CombatTimer.setPause(this.options.id, false, true),\n                },\n                {\n                    condition: () => !this.isManuallyPaused(),\n                    name: `hp.contextMenu.pause`,\n                    icon: `<i class=\"fas fa-pause\"></i>`,\n                    callback: () => CombatTimer.setPause(this.options.id, true, true),\n                },\n                {\n                    name: `hp.contextMenu.reset`,\n                    icon: `<i class=\"fas fa-arrow-rotate-right\"></i>`,\n                    callback: () => this.startTimer(true),\n                },\n                {\n                    condition: !!this.isSecondary,\n                    name: `hp.contextMenu.close`,\n                    icon: `<i class=\"fas fa-close\"></i>`,\n                    callback: () => {\n                        CombatTimer.deleteTimer(this.options.id);\n                    }\n                }\n            ],\n            { jQuery: false, fixed: true }\n        );\n    }\n\n    _prepareContext(...args) {\n        return {};\n    }\n\n    setPosition(...args) {\n        super.setPosition(...args);\n        this.element.style.width = \"auto\";\n        this.element.style.height = \"auto\";\n    }\n\n    _onClose(...args) {\n        clearInterval(this.sleepTimer);\n        this.started = false;\n        this.critSound?.stop();\n        game.combatTimer = null;\n        if(!this.name && this.isSecondary) this.deletePosition();\n        delete CombatTimer.timerInstances[this.options.id];\n        return super._onClose(...args);\n    }\n\n    renderTemplate() {\n        this.render(true);\n        this.updateTime(true);\n    }\n\n    static start(options = {}) {\n        if(!options.isSecondary) {\n            if (!game.combatTimer) game.combatTimer = new CombatTimer(options);\n            if (!game.combatTimer.rendered) game.combatTimer.render({ force: true});\n            game.combatTimer.startTimer();\n        } else {\n            const combatTimer = new CombatTimer(options);\n            combatTimer.render({ force: true});\n            combatTimer.startTimer();\n        }\n    }\n\n    static socketTimer({time, name}) {\n        CombatTimer.start({ time, name, isSecondary: true });\n    }\n\n    static async createTimer(time, {name = \"\", isSecondary = false, color = null, paused = false, style = null} = {}) {\n        time = Number.isFinite(time) ? time : game.settings.get(\"hurry-up\", \"timerDuration\");\n        const currentTimersData = game.settings.get(\"hurry-up\", \"timersData\") ?? {};\n        let id;\n        if(isSecondary) {\n            id = name ? `hurry-up-${name.slugify({strict: true})}` : `hurry-up-${randomID(10)}`;\n            if (id in currentTimersData) return ui.notifications.error(`Timer with name ${name} already exists`);\n        } else {\n            id = \"hurry-up\";\n            if (id in currentTimersData) return this.reset(id);\n        }\n        currentTimersData[id] = {\n            id: id,\n            isSecondary: isSecondary,\n            name: name,\n            time: time,\n            startedAt: game.time.serverTime,\n            pausedAt: paused || game?.paused ? game.time.serverTime : undefined,\n            pausedFor: 0,\n            manuallyPaused: paused,\n            color: color,\n            style: style\n        };\n        return await game.settings.set(\"hurry-up\", \"timersData\", currentTimersData);\n    }\n\n    static async deleteTimer(id) {\n        const currentTimersData = game.settings.get(\"hurry-up\", \"timersData\") ?? {};\n        delete currentTimersData[id];\n        return await game.settings.set(\"hurry-up\", \"timersData\", currentTimersData);\n    }\n\n    static async checkAndCreateMainTimer() {\n        if(game.settings.get(\"hurry-up\", \"disable\")) return CombatTimer.deleteTimer(\"hurry-up\");\n        const token = canvas.tokens.get(game?.combat?.current?.tokenId);\n        const actor = token?.actor;\n        if (game.settings.get(\"hurry-up\", \"runForNPC\") || actor?.hasPlayerOwner) {\n            CombatTimer.createTimer();\n        } else {\n            CombatTimer.deleteTimer(\"hurry-up\");\n        }\n    }\n\n    static updateAndSync() {\n        const timersData = game.settings.get(\"hurry-up\", \"timersData\") ?? {};\n        for (const timerData of Object.values(timersData)) {\n            const timer = CombatTimer.timerInstances[timerData.id];\n            if (timer) {\n                timer.setupTimer(true);\n            } else {\n                new CombatTimer(timerData.id).render({ force: true});\n            }\n        }\n        for (const timer of Object.values(CombatTimer.timerInstances)) {\n            if (!timersData[timer.options.id]) {\n                timer.close();\n            }\n        }\n    }\n}\n","import { MODULE_ID } from \"../main.js\";\r\n\r\nconst PARTIAL_KEY = \"6uy8g1tXqHlhlp65dhiL-genericFormHelper-\" + \"hurry-up\";\r\n\r\nexport class FormBuilder {\r\n    constructor() {\r\n        this.submitButton();\r\n    }\r\n\r\n    #tabs = [];\r\n    #fields = [];\r\n    #buttons = [];\r\n    #options = {\r\n        position: {\r\n            width: 560,\r\n            height: \"auto\",\r\n        },\r\n        window: {},\r\n    };\r\n\r\n    #currentTab = null;\r\n    #currentFieldset = null;\r\n    #object = null;\r\n    #app = null;\r\n\r\n    get app() {\r\n        return this.#app;\r\n    }\r\n\r\n    async render() {\r\n        const app = this.form();\r\n        app.render(true);\r\n        return app.promise;\r\n    }\r\n\r\n    form() {\r\n        if (this.#app) return this.#app;\r\n        const app = new FormHelper({ tabs: this.#tabs, fields: this.#fields, buttons: this.#buttons, options: this.#options });\r\n        this.#app = app;\r\n        return app;\r\n    }\r\n\r\n    getHTML() {\r\n        const app = this.form();\r\n        const data = app._prepareContext();\r\n        FormHelper.registerPartial();\r\n        return renderTemplate(PARTIAL_KEY, data);\r\n    }\r\n\r\n    getAsClass(options) {\r\n        const classData = { ...options, tabs: this.#tabs, fields: this.#fields, buttons: this.#buttons, options: this.#options };\r\n\r\n        return class extends FormHelper {\r\n            constructor(data = {}) {\r\n                super({ ...classData, ...data });\r\n            }\r\n        };\r\n    }\r\n\r\n    onRender(callback) {\r\n        this.#options.onRender = callback;\r\n        return this;\r\n    }\r\n\r\n    registerAsMenu({ moduleId, key, name, label, icon, hint, scope, restricted, defaultValue, onChange, requiresReload } = {}) {\r\n        moduleId ??= MODULE_ID;\r\n        scope ??= \"world\";\r\n        restricted ??= true;\r\n        defaultValue ??= {};\r\n        key ??= \"settings\";\r\n        icon ??= \"fas fa-cogs\";\r\n        label ??= \"Configure\";\r\n        name ??= \"Configuration Menu\";\r\n        hint ??= \"Configure the module settings\";\r\n\r\n        const menuOptions = {\r\n            settingsMenu: {\r\n                requiresReload,\r\n                onChange,\r\n                moduleId,\r\n                key,\r\n            },\r\n        };\r\n\r\n        const cls = this.getAsClass(menuOptions);\r\n\r\n        game.settings.registerMenu(moduleId, key + \"-menu\", {\r\n            name,\r\n            label,\r\n            hint,\r\n            icon,\r\n            scope,\r\n            restricted,\r\n            type: cls,\r\n        });\r\n\r\n        game.settings.register(moduleId, key, {\r\n            scope,\r\n            config: false,\r\n            default: defaultValue,\r\n            type: Object,\r\n            onChange,\r\n            requiresReload,\r\n        });\r\n\r\n        return {\r\n            getSetting: () => game.settings.get(moduleId, key),\r\n            setSetting: (value) => game.settings.set(moduleId, key, value),\r\n        };\r\n    }\r\n\r\n    async insertHTML(element, selector, insertion = \"afterend\") {\r\n        const html = await this.getHTML();\r\n\r\n        const tempEl = document.createElement(\"div\");\r\n        tempEl.innerHTML = html;\r\n        const insertionEl = tempEl.children[0];\r\n\r\n        const el = selector ? element.querySelector(selector) : element;\r\n        if (!el) throw new Error(`Element ${selector} not found`);\r\n        el.insertAdjacentElement(insertion, insertionEl);\r\n        return insertionEl;\r\n    }\r\n\r\n    #addField(field) {\r\n        if (this.#object && field.name) {\r\n            const objectValue = foundry.utils.getProperty(this.#object, field.name);\r\n            if (objectValue !== undefined) field.value = objectValue;\r\n        }\r\n\r\n        if (this.#currentFieldset) return this.#currentFieldset.fields.push(field);\r\n        if (this.#currentTab) return this.#currentTab.fields.push(field);\r\n        return this.#fields.push(field);\r\n    }\r\n\r\n    title(title) {\r\n        this.#options.window.title = title;\r\n        return this;\r\n    }\r\n\r\n    resizable(resizable = true) {\r\n        this.#options.window.resizable = resizable;\r\n        return this;\r\n    }\r\n\r\n    info(info) {\r\n        this.#options.info = info;\r\n        return this;\r\n    }\r\n\r\n    object(object) {\r\n        this.#object = object;\r\n        return this;\r\n    }\r\n\r\n    size({ width, height }) {\r\n        this.#options.position = {\r\n            width: width ?? 560,\r\n            height: height ?? \"auto\",\r\n        };\r\n        return this;\r\n    }\r\n\r\n    submitButton({ enabled = true, label = \"Confirm\", icon = \"fa-solid fa-check\" } = {}) {\r\n        const submitButton = {\r\n            type: \"submit\",\r\n            action: \"submit\",\r\n            icon,\r\n            label,\r\n        };\r\n        if (!enabled) this.#buttons = this.#buttons.filter((b) => b.action !== \"submit\");\r\n        else this.#buttons.push(submitButton);\r\n        return this;\r\n    }\r\n\r\n    tab({ id, group, icon, label, active = false } = {}) {\r\n        group ??= \"sheet\";\r\n        if (!id && this.#currentTab) {\r\n            this.#currentTab = null;\r\n            return this;\r\n        }\r\n        if (!id) throw new Error(\"You must provide an id for the tab\");\r\n        const tab = {\r\n            id,\r\n            group,\r\n            icon,\r\n            label,\r\n            active,\r\n            fields: [],\r\n        };\r\n        this.#tabs.push(tab);\r\n        this.#currentTab = tab;\r\n        return this;\r\n    }\r\n\r\n    fieldset({ legend } = {}) {\r\n        if (!legend && this.#currentFieldset) {\r\n            this.#currentFieldset = null;\r\n            return this;\r\n        }\r\n        if (!legend) throw new Error(\"You must provide a legend for the fieldset\");\r\n        const fieldset = {\r\n            legend,\r\n            fieldset: true,\r\n            fields: [],\r\n        };\r\n        this.#addField(fieldset);\r\n        this.#currentFieldset = fieldset;\r\n        return this;\r\n    }\r\n\r\n    html(html) {\r\n        const field = {\r\n            html,\r\n        };\r\n        this.#addField(field);\r\n        return this;\r\n    }\r\n\r\n    text({ name, label, hint, value }) {\r\n        const field = {\r\n            field: new foundry.data.fields.StringField(),\r\n            name,\r\n            label,\r\n            hint,\r\n            value,\r\n        };\r\n        this.#addField(field);\r\n        return this;\r\n    }\r\n\r\n    number({ name, label, hint, value, min, max, step }) {\r\n        const field = {\r\n            field: new foundry.data.fields.NumberField(),\r\n            name,\r\n            label,\r\n            hint,\r\n            value,\r\n            min,\r\n            max,\r\n            step,\r\n        };\r\n        this.#addField(field);\r\n        return this;\r\n    }\r\n\r\n    checkbox({ name, label, hint, value }) {\r\n        const field = {\r\n            field: new foundry.data.fields.BooleanField(),\r\n            name,\r\n            label,\r\n            hint,\r\n            value,\r\n        };\r\n        this.#addField(field);\r\n        return this;\r\n    }\r\n\r\n    color({ name, label, hint, value }) {\r\n        const field = {\r\n            field: new foundry.data.fields.ColorField(),\r\n            name,\r\n            label,\r\n            hint,\r\n            value,\r\n        };\r\n        this.#addField(field);\r\n        return this;\r\n    }\r\n\r\n    file({ name, type, label, hint, value }) {\r\n        type ??= \"imagevideo\";\r\n        const types = FILE_PICKER_TYPES[type];\r\n        const dataField = new foundry.data.fields.FilePathField({ categories: types });\r\n        dataField.categories = [type];\r\n        const field = {\r\n            field: dataField,\r\n            name,\r\n            label,\r\n            hint,\r\n            type,\r\n            value,\r\n        };\r\n        this.#addField(field);\r\n        return this;\r\n    }\r\n\r\n    select({ name, label, hint, value, options }) {\r\n        const dType = inferSelectDataType(options);\r\n        const field = {\r\n            field: dType === Number ? new foundry.data.fields.NumberField({ choices: options, required: true }) : new foundry.data.fields.StringField({ choices: options, required: true, blank: false }),\r\n            name,\r\n            label,\r\n            hint,\r\n            value: value ?? options[0]?.key,\r\n            options,\r\n        };\r\n        this.#addField(field);\r\n        return this;\r\n    }\r\n\r\n    multiSelect({ name, label, hint, value, options }) {\r\n        const dType = inferSelectDataType(options);\r\n        const dataField = dType === Number ? new foundry.data.fields.NumberField({ choices: options, nullable: false }) : new foundry.data.fields.StringField({ choices: options, nullable: false });\r\n        const field = {\r\n            field: new foundry.data.fields.SetField(dataField),\r\n            name,\r\n            label,\r\n            hint,\r\n            value,\r\n            options,\r\n        };\r\n        this.#addField(field);\r\n        return this;\r\n    }\r\n\r\n    editor({ name, label, hint, value }) {\r\n        const field = {\r\n            field: new foundry.data.fields.HTMLField(),\r\n            name,\r\n            label,\r\n            hint,\r\n            value,\r\n        };\r\n        this.#addField(field);\r\n        return this;\r\n    }\r\n\r\n    textArea({ name, label, hint, value }) {\r\n        const field = {\r\n            field: new foundry.data.fields.JSONField(),\r\n            name,\r\n            label,\r\n            hint,\r\n            value,\r\n            stacked: true,\r\n        };\r\n        this.#addField(field);\r\n        return this;\r\n    }\r\n\r\n    script({ name, label, hint, value }) {\r\n        const field = {\r\n            field: new foundry.data.fields.JavaScriptField(),\r\n            name,\r\n            label,\r\n            hint,\r\n            value,\r\n        };\r\n        this.#addField(field);\r\n        return this;\r\n    }\r\n\r\n    uuid({name, label, hint, value, type, multiple}) {\r\n        const dataField = {\r\n            field: new foundry.data.fields.DocumentUUIDField({type},{}),\r\n            name,\r\n            label,\r\n            hint,\r\n            value,\r\n            type,\r\n            multiple,\r\n        };\r\n        let field;\r\n        if (multiple) {\r\n            field = {\r\n                field: new foundry.data.fields.SetField(dataField.field),\r\n                name,\r\n                label,\r\n                hint,\r\n                value,\r\n                multiple,\r\n            };\r\n        } else {\r\n            field = dataField;\r\n        }\r\n        this.#addField(field);\r\n        return this;\r\n    }\r\n\r\n    button({ label, action, icon, callback }) {\r\n        action ??= foundry.utils.randomID();\r\n        const button = {\r\n            action,\r\n            type: \"button\",\r\n            icon,\r\n            label,\r\n            callback,\r\n        };\r\n        this.#buttons.push(button);\r\n        return this;\r\n    }\r\n}\r\n\r\nconst FILE_PICKER_TYPES = {\r\n    imagevideo: [\"IMAGE\", \"VIDEO\"],\r\n    image: [\"IMAGE\"],\r\n    video: [\"VIDEO\"],\r\n    audio: [\"AUDIO\"],\r\n    font: [\"FONT\"],\r\n    graphics: [\"GRAPHICS\"],\r\n};\r\n\r\nfunction inferSelectDataType(options) {\r\n    const values = Array.isArray(options) ? options.map((o) => o.key) : Object.keys(options);\r\n    try {\r\n        const isNumber = values.every((v) => {\r\n            const n = JSON.parse(v);\r\n            return typeof n === \"number\";\r\n        });\r\n        if (isNumber) return Number;\r\n    } catch (e) {\r\n        return String;\r\n    }\r\n    return String;\r\n}\r\n\r\nexport class FormHelper extends foundry.applications.api.HandlebarsApplicationMixin(foundry.applications.api.ApplicationV2) {\r\n    constructor(data) {\r\n        const actions = {};\r\n        data.buttons.forEach((b) => (actions[b.action] = b.callback));\r\n        super({ actions, ...data.options });\r\n        FormHelper.registerPartial();\r\n        this.menu = data.settingsMenu;\r\n        this.resolve;\r\n        this.reject;\r\n        this.promise = new Promise((resolve, reject) => {\r\n            this.resolve = resolve;\r\n            this.reject = reject;\r\n        });\r\n        this.onRenderFunction = data.options.onRender;\r\n        this.#info = data.options.info;\r\n        this.processFormStructure(data);\r\n    }\r\n\r\n    #fields;\r\n\r\n    #buttons;\r\n\r\n    #info;\r\n\r\n    static DEFAULT_OPTIONS = {\r\n        classes: [\"form-helper\"],\r\n        tag: \"form\",\r\n        window: {\r\n            contentClasses: [\"standard-form\"],\r\n        },\r\n        position: {\r\n            width: 560,\r\n            height: \"auto\",\r\n        },\r\n        form: {\r\n            handler: this.#onSubmit,\r\n            closeOnSubmit: true,\r\n        },\r\n        actions: {},\r\n    };\r\n\r\n    static PARTS = {\r\n        tabs: {\r\n            template: \"templates/generic/tab-navigation.hbs\",\r\n        },\r\n        genericForm: {\r\n            template: PARTIAL_KEY,\r\n            classes: [\"standard-form\", \"scrollable\"],\r\n        },\r\n        footer: {\r\n            template: \"templates/generic/form-footer.hbs\",\r\n        },\r\n    };\r\n\r\n    static registerPartial() {\r\n        if (Handlebars.partials[PARTIAL_KEY]) return;\r\n        const compiledTemplate = Handlebars.compile(GENERIC_FORM_HBS);\r\n        Handlebars.registerPartial(PARTIAL_KEY, compiledTemplate);\r\n    }\r\n\r\n    processFormStructure(data) {\r\n        const currentSetting = this.menu ? game.settings.get(this.menu.moduleId, this.menu.key) : {};\r\n        const isMenu = !!this.menu;\r\n\r\n        if (data.tabs?.length) {\r\n            this.__tabs = {};\r\n            const active = data.tabs.find((t) => t.active);\r\n            if (!active) data.tabs[0].active = true;\r\n            for (const tab of data.tabs) {\r\n                this.__tabs[tab.id] = {\r\n                    id: tab.id,\r\n                    group: tab.group,\r\n                    icon: tab.icon,\r\n                    label: tab.label,\r\n                    active: tab.active ?? false,\r\n                    fields: tab.fields ?? [],\r\n                };\r\n\r\n                if (isMenu) {\r\n                    const fields = tab.fields ?? [];\r\n                    for (const field of fields) {\r\n                        const settingValue = foundry.utils.getProperty(currentSetting, field.name);\r\n                        if (settingValue !== undefined) field.value = settingValue;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (isMenu) {\r\n            const fields = data.fields ?? [];\r\n            for (const field of fields) {\r\n                const settingValue = foundry.utils.getProperty(currentSetting, field.name);\r\n                if (settingValue !== undefined) field.value = settingValue;\r\n            }\r\n        }\r\n\r\n        this.#fields = data.fields ?? [];\r\n\r\n        this.#buttons = data.buttons ?? [];\r\n    }\r\n\r\n    _onClose(options) {\r\n        super._onClose(options);\r\n        if (!this.promise.resolved) this.resolve(false);\r\n    }\r\n\r\n    _prepareContext(options) {\r\n        return {\r\n            tabs: this.#getTabs(),\r\n            fields: this.#fields,\r\n            info: this.#info,\r\n            buttons: [...this.#buttons.filter((b) => b.type !== \"submit\"), ...this.#buttons.filter((b) => b.type === \"submit\")],\r\n        };\r\n    }\r\n\r\n    _onRender(context, options) {\r\n        super._onRender(context, options);\r\n        if (!this.__tabs) {\r\n            this.element.querySelector(\"nav\").classList.add(\"hidden\");\r\n        }\r\n        if(this.onRenderFunction) this.onRenderFunction.bind(this)(context, options);\r\n    }\r\n\r\n    #getTabs() {\r\n        const tabs = this.__tabs ?? {};\r\n        for (const v of Object.values(tabs)) {\r\n            v.cssClass = v.active ? \"active\" : \"\";\r\n            if (v.active) break;\r\n        }\r\n        return tabs;\r\n    }\r\n\r\n    changeTab(...args) {\r\n        super.changeTab(...args);\r\n    }\r\n\r\n    _onChangeForm(formConfig, event) {\r\n        super._onChangeForm(formConfig, event);\r\n        const formData = new FormDataExtended(this.element);\r\n    }\r\n\r\n    getFormData() {\r\n        const formData = new FormDataExtended(this.element);\r\n        return foundry.utils.expandObject(formData.object);\r\n    }\r\n\r\n    static async #onSubmit(event, form, formData) {\r\n        const data = foundry.utils.expandObject(formData.object);\r\n        this.resolve(data);\r\n        if (this.menu) {\r\n            if (this.menu.requiresReload) SettingsConfig.reloadConfirm();\r\n            if (this.menu.onChange) this.menu.onChange(data);\r\n            return game.settings.set(this.menu.moduleId, this.menu.key, data);\r\n        }\r\n    }\r\n}\r\n\r\nconst FIELD_INNER_HBS = `\r\n    {{#if field.fieldset}}\r\n    <fieldset>\r\n        <legend>{{localize field.legend}}</legend>\r\n        {{#each field.fields as |f|}}\r\n        {{#if f.html}}{{{f.html}}}{{else}}\r\n        {{formField f.field stacked=f.stacked type=f.type label=f.label hint=f.hint name=f.name value=f.value min=f.min max=f.max step=f.step localize=true}}\r\n        {{/if}}\r\n        {{/each}}\r\n    </fieldset>\r\n    {{else}}\r\n    {{#if field.html}}{{{field.html}}}{{else}}\r\n    {{formField field.field stacked=field.stacked multiple=field.multiple type=field.type label=field.label hint=field.hint name=field.name value=field.value min=field.min max=field.max step=field.step localize=true}}\r\n    {{/if}}\r\n    {{/if}}\r\n        `;\r\n\r\nconst GENERIC_FORM_HBS = `<div>\r\n    {{#if info}}{{{info}}}{{/if}}\r\n    {{#each tabs as |tab|}}\r\n\r\n    <section class=\"tab standard-form scrollable {{tab.cssClass}}\" data-tab=\"{{tab.id}}\" data-group=\"{{tab.group}}\">\r\n        {{#each tab.fields as |field|}}\r\n        ${FIELD_INNER_HBS}\r\n        {{/each}}\r\n    </section>\r\n\r\n    {{/each}}\r\n\r\n    {{#each fields as |field|}}\r\n    ${FIELD_INNER_HBS}\r\n    {{/each}}\r\n</div>`;    ","import { CombatTimer } from \"./app/CombatTimer.js\";\r\nimport { registerSettings } from \"./settings.js\";\r\nimport { Socket } from \"./lib/socket.js\";\r\nimport { FormBuilder } from \"./lib/formBuilder.js\";\r\nimport \"../scss/module.scss\";\r\n\r\nexport const MODULE_ID = \"hurry-up\";\r\n\r\nregisterSettings();\r\n\r\nHooks.once(\"init\", () => {\r\n    Socket.register(\"StartTimer\", CombatTimer.socketTimer);\r\n    globalThis.CombatTimer = CombatTimer;\r\n});\r\n\r\nHooks.on(\"ready\", () => {\r\n    CombatTimer.updateAndSync();\r\n});\r\n\r\nHooks.on(\"updateCombat\", (combat, updates) => {\r\n    if (!game.user.isActiveGM) return;\r\n    if (!game.combat?.started) return CombatTimer.deleteTimer(\"hurry-up\");\r\n    if ((\"turn\" in updates || \"round\" in updates)) CombatTimer.checkAndCreateMainTimer();\r\n});\r\n\r\nHooks.on(\"deleteCombat\", (combat, updates) => {\r\n    if (!game.user.isActiveGM) return;\r\n    CombatTimer.deleteTimer(\"hurry-up\");\r\n});\r\n\r\nHooks.on(\"pauseGame\", async (paused) => {\r\n    if (!game.user.isActiveGM) return;\r\n    for (const timer of Object.values(CombatTimer.timerInstances)) {\r\n        await CombatTimer.setPause(timer.options.id, paused, false);\r\n    }\r\n});\r\n\r\nHooks.on(\"chatMessage\", (chatLog, messageText, chatData) => {\r\n    if (!game.user.isGM) return true;\r\n    const match = messageText.match(/^\\/(?:hurry|timer)(\\?)?(?:\\s+((?:\\d+[:hms]?)+))?/i);\r\n    \r\n    if (match) {\r\n        const paused = match[1] ? true : false;\r\n        const time = match[2] ? parseTime(match[2].trim()) : undefined;\r\n\r\n        if(match[2]) {\r\n            CombatTimer.createTimer(time, {isSecondary: true, paused});\r\n            return false;\r\n        }\r\n\r\n        const style = game.settings.get(\"hurry-up\", \"style\");\r\n        const styles = game.settings.settings.get(\"hurry-up.style\").choices;\r\n        const formBuilder = (new FormBuilder())\r\n            .title(\"hp.create.title\")\r\n            .checkbox({name: \"paused\", label: \"hp.create.paused\", value: paused})\r\n            .number({name: \"time\", label: \"hp.create.time\", value: time ?? game.settings.get(\"hurry-up\", \"timerDuration\")})\r\n            .text({name: \"name\", label: \"hp.create.name\", value: name})\r\n            .color({name: \"color\", label: \"hp.create.color\", value: \"\"})\r\n            .select({name: \"timerStyle\", label: \"hp.settings.style.name\", value: style, options: styles});\r\n            \r\n        formBuilder.render().then(data => {\r\n            if(!data) return;\r\n            if(!data.time || data.time <= 0) return ui.notifications.error(\"hp.create.timeError\");\r\n            CombatTimer.createTimer(\r\n                parseTime(data.time), \r\n                {\r\n                    isSecondary: true,\r\n                    name: data.name,\r\n                    paused: !!data.paused,\r\n                    color: data.color,\r\n                    style: data.timerStyle\r\n                }\r\n            );\r\n        });      \r\n\r\n        return false;\r\n    }\r\n    \r\n    return true;\r\n});\r\n\r\nfunction parseTime(input) {\r\n    let hours = 0,\r\n        minutes = 0,\r\n        seconds = 0;\r\n\r\n    const hmsRegex = /^(\\d+)h(\\d+)m(\\d+)s$|^(\\d+):(\\d+):(\\d+)$/;\r\n    const msRegex = /^(\\d+)m(\\d+)s$|^(\\d+):(\\d+)$/;\r\n    const hmRegex = /^(\\d+)h(\\d+)m$/;\r\n    const hsRegex = /^(\\d+)h(\\d+)s$/;\r\n    const hRegex = /^(\\d+)h$/;\r\n    const mRegex = /^(\\d+)m$/;\r\n    const sRegex = /^(\\d+)s$/;\r\n\r\n    if (hmsRegex.test(input)) {\r\n        const match = input.match(hmsRegex);\r\n        hours = parseInt(match[1] ?? match[4]);\r\n        minutes = parseInt(match[2] ?? match[5]);\r\n        seconds = parseInt(match[3] ?? match[6]);\r\n    } else if (msRegex.test(input)) {\r\n        const match = input.match(msRegex);\r\n        minutes = parseInt(match[1] ?? match[3]);\r\n        seconds = parseInt(match[2] ?? match[4]);\r\n    } else if (hmRegex.test(input)) {\r\n        const match = input.match(hmRegex);\r\n        hours = parseInt(match[1]);\r\n        minutes = parseInt(match[2]);\r\n    } else if (hsRegex.test(input)) {\r\n        const match = input.match(hsRegex);\r\n        hours = parseInt(match[1]);\r\n        seconds = parseInt(match[2]);\r\n    } else if (hRegex.test(input)) {\r\n        const match = input.match(hRegex);\r\n        hours = parseInt(match[1]);\r\n    } else if (mRegex.test(input)) {\r\n        const match = input.match(mRegex);\r\n        minutes = parseInt(match[1]);\r\n    } else if (sRegex.test(input)) {\r\n        const match = input.match(sRegex);\r\n        seconds = parseInt(match[1]);\r\n    } else {\r\n        const int = parseInt(input);\r\n        if (!isNaN(int)) {\r\n            seconds = int;\r\n        }\r\n        return seconds;\r\n    }\r\n\r\n    return hours * 3600 + minutes * 60 + seconds;\r\n}\r\n","import { CombatTimer } from \"./app/CombatTimer\";\n\nexport function registerSettings() {\n\n  Hooks.once(\"init\", async function () {\n\n    game.settings.register(\"hurry-up\", \"timersData\", {\n      scope: \"world\",\n      config: false,\n      type: Object,\n      default: false,\n      onChange: () => {\n        CombatTimer.updateAndSync();\n      }\n    });\n\n    game.settings.register(\"hurry-up\", \"disable\", {\n      name: game.i18n.localize(\"hp.settings.disable.name\"),\n      hint: game.i18n.localize(\"hp.settings.disable.hint\"),\n      scope: \"world\",\n      config: true,\n      type: Boolean,\n      default: false,\n    });\n\n    game.settings.register(\"hurry-up\", \"timerDuration\", {\n      name: game.i18n.localize(\"hp.settings.timerDuration.name\"),\n      hint: game.i18n.localize(\"hp.settings.timerDuration.hint\"),\n      scope: \"world\",\n      config: true,\n      type: Number,\n      default: 300,\n      onChange: (sett) => {\n        CombatTimer.deleteTimer(\"hurry-up\");\n        CombatTimer.checkAndCreateMainTimer();\n      }\n    });\n\n    game.settings.register(\"hurry-up\", \"style\", {\n      name: game.i18n.localize(\"hp.settings.style.name\"),\n      hint: game.i18n.localize(\"hp.settings.style.hint\"),\n      scope: \"client\",\n      config: true,\n      type: String,\n      choices: {\n        \"digits\": \"hp.settings.style.digits\",\n        \"circle\": \"hp.settings.style.circle\",\n        \"sand\": \"hp.settings.style.sand\",\n      },\n      default: \"digits\",\n      onChange: () => {\n        CombatTimer.updateAndSync();\n      }\n    });\n\n    game.settings.register(\"hurry-up\", \"countup\", {\n      name: game.i18n.localize(\"hp.settings.countup.name\"),\n      hint: game.i18n.localize(\"hp.settings.countup.hint\"),\n      scope: \"world\",\n      config: true,\n      type: Boolean,\n      default: false,\n    });\n\n    // game.settings.register(\"hurry-up\", \"overtime\", {\n    //   name: game.i18n.localize(\"hp.settings.overtime.name\"),\n    //   hint: game.i18n.localize(\"hp.settings.overtime.hint\"),\n    //   scope: \"world\",\n    //   config: true,\n    //   type: Boolean,\n    //   default: false,\n    // });\n\n    game.settings.register(\"hurry-up\", \"size\", {\n      name: game.i18n.localize(\"hp.settings.size.name\"),\n      hint: game.i18n.localize(\"hp.settings.size.hint\"),\n      scope: \"client\",\n      config: true,\n      type: Number,\n      range: {\n        min: 5,\n        max: 15,\n        step: 0.5,\n      },\n      default: 8,\n      onChange: (sett) => {\n        document.documentElement.style.setProperty(\n          \"--hurry-up-font-size\",\n          sett + \"em\"\n        );\n      }\n    });\n\n    game.settings.register(\"hurry-up\", \"windowless\", {\n      name: game.i18n.localize(\"hp.settings.windowless.name\"),\n      hint: game.i18n.localize(\"hp.settings.windowless.hint\"),\n      scope: \"client\",\n      config: true,\n      type: Boolean,\n      default: false,\n      onChange: () => {\n        CombatTimer.updateAndSync();\n      }\n    });\n\n    game.settings.register(\"hurry-up\", \"critical\", {\n      name: game.i18n.localize(\"hp.settings.critical.name\"),\n      hint: game.i18n.localize(\"hp.settings.critical.hint\"),\n      scope: \"world\",\n      config: true,\n      type: Number,\n      range: {\n        min: 1,\n        max: 100,\n        step: 1,\n      },\n      default: 10,\n    });\n\n    game.settings.register(\"hurry-up\", \"secondsInsteadOfPercentage\", {\n      name: game.i18n.localize(\"hp.settings.secondsInsteadOfPercentage.name\"),\n      hint: game.i18n.localize(\"hp.settings.secondsInsteadOfPercentage.hint\"),\n      scope: \"world\",\n      config: true,\n      type: Boolean,\n      default: false,\n    });\n\n    game.settings.register(\"hurry-up\", \"goNext\", {\n      name: game.i18n.localize(\"hp.settings.goNext.name\"),\n      hint: game.i18n.localize(\"hp.settings.goNext.hint\"),\n      scope: \"world\",\n      config: true,\n      type: Boolean,\n      default: false,\n    });\n\n    game.settings.register(\"hurry-up\", \"runForNPC\", {\n      name: game.i18n.localize(\"hp.settings.runForNpc.name\"),\n      hint: game.i18n.localize(\"hp.settings.runForNpc.hint\"),\n      scope: \"world\",\n      config: true,\n      type: Boolean,\n      default: false,\n    });\n\n    game.settings.register(\"hurry-up\", \"critSoundPath\", {\n      name: game.i18n.localize(\"hp.settings.critSoundPath.name\"),\n      hint: game.i18n.localize(\"hp.settings.critSoundPath.hint\"),\n      scope: \"world\",\n      config: true,\n      type: String,\n      default: \"modules/hurry-up/sounds/tick1.mp3\",\n      filePicker: \"audio\",\n    });\n\n    game.settings.register(\"hurry-up\", \"endSoundPath\", {\n      name: game.i18n.localize(\"hp.settings.endSoundPath.name\"),\n      hint: game.i18n.localize(\"hp.settings.endSoundPath.hint\"),\n      scope: \"world\",\n      config: true,\n      type: String,\n      default: \"modules/hurry-up/sounds/Ping1.mp3\",\n      filePicker: \"audio\",\n    });\n\n    game.settings.register(\"hurry-up\", \"soundVol\", {\n      name: game.i18n.localize(\"hp.settings.soundVol.name\"),\n      hint: game.i18n.localize(\"hp.settings.soundVol.hint\"),\n      scope: \"world\",\n      config: true,\n      type: Number,\n      range: {\n        min: 0,\n        max: 1,\n        step: 0.05,\n      },\n      default: 0.8,\n    });\n  });\n\n}"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Socket","static","GMS","PLAYERS","ALL","OTHERS","FIRSTGM","SELF","__$onMessage","data","options","__$socketOptions","__$storeName","__$request","store","this","__$stores","_isLive","game","socket","emit","MODULE_ID","user","id","getData","synchronize","users","__$eventName","__$responseKey","__$promises","resolve","__$userId","response","result","includes","callback","__$callbacks","__$eventId","__$socket","__$parseUsers","Array","isArray","USERS","active","filter","u","map","isGM","activeGM","register","eventName","defaultOptions","on","bind","__$reserved","Error","async","eventId","foundry","utils","randomID","promises","local","push","Promise","reject","setTimeout","timeout","results","localWrapper","allPromises","all","promise","registerStore","storeName","initialValue","SynchronizedStore","set","value","setData","constructor","_storeName","_onChange","_data","_timestamp","Date","now","HandlebarsApplication","applications","api","HandlebarsApplicationMixin","ApplicationV2","args","super","registerPositionSetting","savePosition","debounce","POSITION_SETTING_REGISTERED","DEFAULT_OPTIONS","window","settings","APP_ID","scope","config","type","default","resetSavedPosition","position","positionToSave","left","top","width","height","currentSettings","deletePosition","setPosition","r","name","split","join","toLowerCase","PARTS","content","template","classes","scrollable","tag","title","frame","positioned","icon","controls","minimizable","resizable","contentTag","contentClasses","preventEscapeClose","actions","form","handler","undefined","submitOnChange","closeOnSubmit","_prepareContext","activateListeners","_onRender","context","instances","delete","close","style","display","html","element","render","options1","options2","activeOptions","savedPosition","l","x","i18n","localize","CombatTimer","overrideOptions","isSecondary","innerHeight","innerWidth","mainName","started","sleepTimer","setupTimer","sandFrame","timerInstances","startTimer","setupColors","color","getComputedStyle","glassColor","criticalColor","barCriticalColor","timerData","timeNow","time","serverTime","countup","startedAt","manuallyPaused","pausedAt","pausedFor","paused","timeElapsed","timeRemaining","Math","floor","max","isPaused","hasEnded","reset","currentTimersData","setPause","manual","isCurrentlyPaused","isEnteringPause","isExitingPause","isManuallyPaused","isSecondaryTimer","_configureRenderParts","parts","mergeClone","other","deepClone","mergeObject","setInterval","updateTime","onEnd","endSound","combat","nextTurn","sleep","ms","critSound","stop","soundP","audio","AudioHelper","play","src","autoplay","volume","loop","updateVisuals","updateDigits","updateCircle","updateSand","forceRender","playing","pause","checkCritical","minimized","_updateFrame","getFormattedTime","hours","minutes","seconds","padStart","querySelector","textContent","percent","min","circleAngle","canvasSize","halfCanvasSize","radius","canvas","setAttribute","getContext","sAngle","PI","eAngle","clearRect","fillStyle","moveTo","beginPath","arc","globalAlpha","lineWidth","strokeStyle","stroke","fill","closePath","isCritical","shadowOffsetX","shadowOffsetY","shadowColor","shadowBlur","canvasWidth","canvasHeight","canvasHalfHeight","canvasHalfWidth","canvasMargin","round","glassMargin","maxIncrement","increment","restore","bezierCurveTo","quadraticCurveTo","save","clip","lineTo","lineDashOffset","setLineDash","lineCap","updateWindowless","windowHeaderElement","getElementsByClassName","length","classList","add","remove","onCriticalEnd","setCriticalStyle","onCritical","backgroundColor","minimize","maximize","document","documentElement","setProperty","_onFirstRender","ux","ContextMenu","condition","deleteTimer","jQuery","fixed","_onClose","clearInterval","combatTimer","renderTemplate","start","force","rendered","socketTimer","createTimer","Number","isFinite","slugify","strict","ui","notifications","error","checkAndCreateMainTimer","token","tokens","current","tokenId","actor","hasPlayerOwner","updateAndSync","timersData","values","timer","PARTIAL_KEY","FormBuilder","submitButton","app","FormHelper","tabs","fields","buttons","getHTML","registerPartial","getAsClass","classData","onRender","registerAsMenu","moduleId","label","hint","restricted","defaultValue","onChange","requiresReload","menuOptions","settingsMenu","cls","registerMenu","getSetting","setSetting","insertHTML","selector","insertion","tempEl","createElement","innerHTML","insertionEl","children","el","insertAdjacentElement","field","objectValue","getProperty","info","object","size","enabled","action","b","tab","group","fieldset","legend","text","StringField","number","step","NumberField","checkbox","BooleanField","ColorField","file","types","FILE_PICKER_TYPES","dataField","FilePathField","categories","select","inferSelectDataType","choices","required","blank","multiSelect","nullable","SetField","editor","HTMLField","textArea","JSONField","stacked","script","JavaScriptField","uuid","multiple","DocumentUUIDField","button","imagevideo","image","video","font","graphics","keys","every","v","JSON","parse","e","String","forEach","menu","onRenderFunction","processFormStructure","genericForm","footer","Handlebars","partials","compiledTemplate","compile","GENERIC_FORM_HBS","currentSetting","isMenu","__tabs","find","t","settingValue","resolved","cssClass","changeTab","_onChangeForm","formConfig","event","FormDataExtended","getFormData","formData","expandObject","SettingsConfig","reloadConfirm","FIELD_INNER_HBS","parseTime","input","hmsRegex","msRegex","hmRegex","hsRegex","hRegex","mRegex","sRegex","test","match","parseInt","int","isNaN","registerSettings","Hooks","once","Boolean","sett","range","filePicker","globalThis","updates","isActiveGM","chatLog","messageText","chatData","trim","styles","then","timerStyle"],"ignoreList":[],"sourceRoot":""}